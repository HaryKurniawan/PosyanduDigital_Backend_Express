generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String   @id @default(uuid())
  name                String
  email               String   @unique
  password            String
  role                Role     @default(USER)
  hasCompletedProfile Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  motherData    MotherData?
  spouseData    SpouseData?
  childrenData  ChildData[]
  registrations PosyanduRegistration[]

  @@map("users")
}

model MotherData {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fullName        String
  phoneNumber     String
  nik             String
  birthPlace      String
  birthDate       DateTime
  education       String
  occupation      String
  bloodType       String
  jkn             String
  facilityTK1     String
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("mother_data")
}

model SpouseData {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fullName        String
  nik             String
  occupation      String
  phoneNumber     String
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("spouse_data")
}

model ChildData {
  id                String   @id @default(uuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fullName          String
  nik               String   @unique  
  birthCertificate  String
  childOrder        Int
  bloodType         String
  birthPlace        String
  birthDate         DateTime
  
  examinations      ChildExamination[]
  registrations     PosyanduRegistration[]
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("children_data")
}

model PosyanduSchedule {
  id          String   @id @default(uuid())
  scheduleDate DateTime
  location    String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  examinations  ChildExamination[]
  registrations PosyanduRegistration[]

  @@map("posyandu_schedules")
}

model PosyanduRegistration {
  id          String   @id @default(uuid())
  scheduleId  String
  schedule    PosyanduSchedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  childId     String
  child       ChildData @relation(fields: [childId], references: [id], onDelete: Cascade)
  userId      String
  user        User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  status      RegistrationStatus @default(REGISTERED)
  registeredAt DateTime @default(now())
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([scheduleId, childId])
  @@map("posyandu_registrations")
}

model ChildExamination {
  id                String   @id @default(uuid())
  childId           String
  child             ChildData @relation(fields: [childId], references: [id], onDelete: Cascade)
  scheduleId        String
  schedule          PosyanduSchedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  
  examinationDate   DateTime
  weight            Float
  height            Float
  headCircumference Float
  armCircumference  Float
  immunization      String
  notes             String?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("child_examinations")
}

enum Role {
  USER
  ADMIN
}

enum RegistrationStatus {
  REGISTERED
  ATTENDED
  CANCELLED
}